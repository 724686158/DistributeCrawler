<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=640" />

    <link rel="stylesheet" href="stylesheets/core.css" media="screen"/>
    <link rel="stylesheet" href="stylesheets/mobile.css" media="handheld, only screen and (max-device-width:640px)"/>
    <link rel="stylesheet" href="stylesheets/pygment_trac.css"/>

    <script type="text/javascript" src="javascripts/modernizr.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="javascripts/headsmart.min.js"></script>
    <script type="text/javascript">
      $(document).ready(function () {
        $('#main_content').headsmart()
      })
    </script>
    <title>Distributecrawler by gsh199449</title>
  </head>

  <body>
    <a id="forkme_banner" href="https://github.com/gsh199449/DistributeCrawler">View on GitHub</a>
    <div class="shell">

      <header>
        <span class="ribbon-outer">
          <span class="ribbon-inner">
            <h1>Distributecrawler</h1>
            <h2></h2>
          </span>
          <span class="left-tail"></span>
          <span class="right-tail"></span>
        </span>
      </header>

      <section id="downloads">
        <span class="inner">
          <a href="https://github.com/gsh199449/DistributeCrawler/zipball/master" class="zip"><em>download</em> .ZIP</a><a href="https://github.com/gsh199449/DistributeCrawler/tarball/master" class="tgz"><em>download</em> .TGZ</a>
        </span>
      </section>


      <span class="banner-fix"></span>


      <section id="main_content">
        <h1>
<a name="distributecrawler" class="anchor" href="#distributecrawler"><span class="octicon octicon-link"></span></a>DistributeCrawler</h1>

<h1>
<a name="%E7%AE%80%E4%BB%8B" class="anchor" href="#%E7%AE%80%E4%BB%8B"><span class="octicon octicon-link"></span></a>简介</h1>

<p>这是一个基于Hadoop的分布式爬虫，目前只支持抓取腾讯新闻中心的新闻内容。支持插件机制，可以通过实现Extractor接口自己编写插件已实现对于各种网站的抓取和内容提取。</p>

<h1>
<a name="%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95" class="anchor" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="octicon octicon-link"></span></a>使用方法</h1>

<ol>
<li>
<p>在com.gs.main.Test1中设置爬取时需要的各种参数</p>

<div class="highlight highlight-Java"><pre><span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">dst</span> <span class="o">=</span> <span class="s">"hdfs://gs-pc:9000/home/test/qq.txt"</span><span class="o">;</span><span class="c1">//首页的链接暂存地</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">localSrc</span> <span class="o">=</span> <span class="s">"/home/gaoshen/qq.txt"</span><span class="o">;</span><span class="c1">//在master机器的暂存地</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">depth</span> <span class="o">=</span> <span class="mi">3</span><span class="o">;</span><span class="c1">//深度</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">topN</span> <span class="o">=</span> <span class="mi">50</span><span class="o">;</span><span class="c1">//每页抓取的最大链接数</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">outputPath</span> <span class="o">=</span> <span class="s">"hdfs://gs-pc:9000/home/test/output"</span><span class="o">;</span><span class="c1">//最终结果的输出路径</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="s">"http://news.qq.com"</span><span class="o">;</span><span class="c1">//需要抓取的地址</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">jobName</span> <span class="o">=</span> <span class="s">"DistributeCrawler"</span><span class="o">;</span><span class="c1">//Job的名称</span>
</pre></div>
</li>
</ol><p>2.设置Redis里面的IP和端口</p>

<div class="highlight highlight-Java"><pre><span class="n">jj</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Jedis</span><span class="o">(</span><span class="s">"localhost"</span><span class="o">,</span><span class="mi">8888</span><span class="o">);</span>
</pre></div>

<p>3.然后就可以在Hadoop平台上运行了。</p>

<h1>
<a name="%E6%8A%93%E5%8F%96%E6%B5%81%E7%A8%8B" class="anchor" href="#%E6%8A%93%E5%8F%96%E6%B5%81%E7%A8%8B"><span class="octicon octicon-link"></span></a>抓取流程</h1>

<ol>
<li>首先先从<code>news.qq.com</code>上下载首页的所有连接。并存储到master本地，再写入HDFS。</li>
<li>然后通过HDFS的本地计算将一个文件分发到各台Slaves上面。</li>
<li>然后各台Slave机器调用map方法开始抓取。若未达到topN和depth限制则将本页面的连接加入到本机的待抓取队列中。再加入队列之前与Redis服务器进行通信，以确保该url未被其他机器抓取。</li>
<li>每个页面通过<code>HttpClient</code>下载完成后，通过正则表达式进行过滤，只保留正文和标题，同时将这个页面封装为一个<code>PagePOJO</code>的POJO。这个POJO包含了正文，标题，URL，该页面的ID号（ID号是通过种子地址在种子文件中的偏移量也就是我们所谓的当前Slaves机器的ID号+一个叠加的计数器，即<code>ID=CrawlerID+counter</code>）。</li>
<li>然后将这个POJO交给Json生成器来生成一个Json内容。</li>
<li>最后通过Hadoop的<code>context</code>写入。</li>
</ol><h1>
<a name="%E7%B4%A2%E5%BC%95%E6%B5%81%E7%A8%8B" class="anchor" href="#%E7%B4%A2%E5%BC%95%E6%B5%81%E7%A8%8B"><span class="octicon octicon-link"></span></a>索引流程</h1>

<ol>
<li>首先通过<code>JsonReader</code>一行一行的读出json内容（每一行是一个Json表达式）。<code>JsonReader</code>是通过<code>RandomAccessFil</code>e来实现的。因为他既可以满足从<code>InputStream</code>中按行读入的要求，还带有获取当前偏移量和skip方法，极为的好用。<code>JsonReader</code>返回一个<code>Hit</code>类型的封装。<code>Hit</code>封装了PagePOJO、文件名和在此文件中的起始偏移量。</li>
<li>提取出每一个<code>Hi</code>t里面的正文、文件名和偏移量，并用<code>Lucene</code>索引。不储存content，但是储存文件名和起始偏移量。这样就可以摆脱对数据库的依赖。</li>
</ol>
      </section>

      <footer>
        <span class="ribbon-outer">
          <span class="ribbon-inner">
            <p>this project by <a href="https://github.com/gsh199449">gsh199449</a> can be found on <a href="https://github.com/gsh199449/DistributeCrawler">GitHub</a></p>
          </span>
          <span class="left-tail"></span>
          <span class="right-tail"></span>
        </span>
        <p>Generated with <a href="http://pages.github.com">GitHub Pages</a> using Merlot</p>
        <span class="octocat"></span>
      </footer>

    </div>

    
  </body>
</html>
